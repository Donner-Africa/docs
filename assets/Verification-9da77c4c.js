import{B as k}from"./BaseButton-566630b0.js";import{_ as S}from"./PublicLayout-d9380c74.js";import{l as B,U as v,S as u,A as m,p as f,r as p,a as r,c as y,w as h,b as o,z as A,q as w,f as l,F as V,g as E,n as I,s as P,C as L,e as C,d as g,t as x}from"./index-5f7a37b4.js";import{N as _}from"./NavigationService-e6cba605.js";import"./logo-f32e4fd3.js";import"./NavigationStore-114d0f28.js";import"./StarryBackground-f8eca98f.js";const U={components:{BaseButton:k,PublicLayout:S},data(){return{loading:!1,resendCount:0,resendWaitTime:0,token:[],verification:{}}},async mounted(){const e=await v.get("isLoggedIn"),t=await v.get("user");if(e&&t.name)return this.$router.push("/");if(this.$route.params.token)await this.verifyEmail(this.$route.params.token);else{const{token:i}=await u.IndexedDB.get("DonnerDB","UserStore","preAuthorization"),a=await u.IndexedDB.get("DonnerDB","UserStore","verification");this.verification=a||{},i||this.$router.push("/account/login")}},computed:{formDisabled(){return this.loading||void 0},codeLength(){var e;return((e=this.verification)==null?void 0:e.credentialType)==="PASSCODE"?4:6},inputType(){var e;return((e=this.verification)==null?void 0:e.credentialType)==="PASSCODE"?"password":"text"},instructionText(){var e;return((e=this.verification)==null?void 0:e.credentialType)==="PASSCODE"?"Enter your account passcode to continue":"A verification code has been sent to your email. If you do not receive the code in 15 minutes, you can"}},methods:{paste(e,t){const i=(e.clipboardData||window.clipboardData).getData("text").trim();this.token=["",...i.split("")],i.length===this.codeLength&&this.completeVerification()},focusNext(e,t){const i=`${e.target.value}`.trim();if(t==this.codeLength&&i)return this.completeVerification();if(i.length===1&&t<this.codeLength){const a="otpInput"+(t+1);this.$refs[a][0].focus()}i.length===0&&t>1&&this.$refs["otpInput"+(t-1)][0].focus()},countDown(){this.resendWaitTime=60+this.resendCount;const e=setInterval(()=>--this.resendWaitTime,999);setTimeout(()=>{clearInterval(e),this.resendWaitTime=0},this.resendWaitTime*1e3)},async completeVerification(){this.loading=!0;try{const e=this.token.reduce((i,a)=>`${i}${a}`),{data:t}=await m.completeAccountVerification({code:e});if(t){const i=await _.get("postAuthenticationPath");await u.IndexedDB.delete("DonnerDB","UserStore","verification"),i?(this.$router.push(i),_.clear("postAuthenticationPath")):window.location="/"}}catch(e){e.getToast?f().toast({message:"A verification error occured. Please, check your code and try again. ",duration:5e3,type:"error"}):console.log(e)}this.loading=!1},async verifyEmail(e){const t=f();try{const{data:i,message:a}=await m.initiateAccountVerification(e);this.countDown(),this.resendWaitTime+=90,t.toast({message:a||"A verification code has been delivered to your email address",type:"success",duration:5e3})}catch{t.toast({message:"There was an error with your verification. Try again.",type:"error",duration:5e3})}},async switchToEmail(){this.loading=!0;const e=f();try{const{data:t}=await m.downgradeToEmail();this.verification=t.verification,await u.IndexedDB.set("DonnerDB","UserStore","verification",t.verification),this.token=[],this.countDown(),e.toast({message:"Switched to Email Verification. Please check your inbox.",type:"success"})}catch(t){e.toast({message:t.message||"Failed to switch to email verification.",type:"error"})}this.loading=!1}}},N={class:"page-header min-vh-100 align-items-start bg-background"},W={class:"container px-sm-auto px-0"},z={class:"row"},F={class:"col-lg-6 col-md-7 mx-sm-auto mx-0 my-0 my-sm-5 px-0 px-sm-auto py-sm-7"},O={class:"card rounded-3 min-vh-100 min-vh-sm-80 bg-transparent"},q={class:"card-body px-lg-5 py-lg-5 text-start"},M={class:"px-md-4 ps-2 pe-4 row"},R={class:"form-group mt-3"},K={class:"row"},Y={class:"form-group"},j=["type","onUpdate:modelValue","disabled","onInput"],G={class:"form-group mt-3 pt-4"},H={key:0,class:"w-[100%] mb-4 text-bold text-foreground"},J={key:1,class:"w-[100%] mb-4 text-foreground"};function Q(e,t,i,a,c,s){const b=p("BaseButton"),D=p("RouterLink"),T=p("PublicLayout");return r(),y(T,null,{default:h(()=>[o("section",null,[o("div",N,[o("div",W,[o("div",z,[o("div",F,[o("div",O,[o("div",q,[t[5]||(t[5]=o("div",{class:"success mb-6 mb-md-4"},[o("a",{href:"/",class:"d-none d-md-inline-block icon icon-shape icon-xl rounded-circle bg-background shadow text-center p-3 mx-auto"},[o("img",{src:A,class:"w-[90%] h-[90%] mt-1"})])],-1)),t[6]||(t[6]=o("h2",{class:"text-foreground"},"Verify your account",-1)),o("form",{class:"form-section active",onSubmit:t[2]||(t[2]=w((...n)=>s.completeVerification&&s.completeVerification(...n),["prevent"]))},[o("div",M,[o("div",R,[o("div",K,[(r(!0),l(V,null,E(s.codeLength,n=>(r(),l("div",{class:I(s.codeLength===4?"col-3":"col-2"),key:n},[o("div",Y,[P(o("input",{type:s.inputType,class:"form-control form-control-lg text-center px-0 border",maxlength:"1","onUpdate:modelValue":d=>c.token[n]=d,autocomplete:"off",disabled:s.formDisabled,autocapitalize:"none",ref_for:!0,ref:"otpInput"+n,onPaste:t[0]||(t[0]=w((...d)=>s.paste&&s.paste(...d),["prevent"])),onInput:d=>s.focusNext(d,n)},null,40,j),[[L,c.token[n]]])])],2))),128))])]),o("div",G,[C(b,{class:"btn btn-primary float-end",loading:c.loading,nativeType:"submit"},{default:h(()=>[...t[3]||(t[3]=[g(" Continue ",-1)])]),_:1},8,["loading"])]),c.resendWaitTime==0?(r(),l("span",H,[g(x(s.instructionText)+" ",1),c.verification.credentialType!=="PASSCODE"?(r(),y(D,{key:0,to:"/account/login",style:{cursor:"pointer"},class:"text-success"},{default:h(()=>[...t[4]||(t[4]=[g(" request another code ",-1)])]),_:1})):(r(),l("span",{key:1,onClick:t[1]||(t[1]=(...n)=>s.switchToEmail&&s.switchToEmail(...n)),style:{cursor:"pointer"},class:"text-success font-weight-bold"}," Forgot Passcode? Use Email "))])):(r(),l("span",J," You can request another verification code in "+x(c.resendWaitTime)+"s ",1))])],32)])])])])])])])]),_:1})}const st=B(U,[["render",Q]]);export{st as default};
