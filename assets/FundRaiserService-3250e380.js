import{ag as S,ah as a,p as $,ai as w,S as d}from"./index-224ff9c4.js";const f="Nigeria",g="NGN",l={category:"",subCategory:"",title:"",story:"",country:f,currency:g,titleMode:"",goal:"",sdgs:[]},h=localStorage.getItem("newFundRaiser");let p=l;h&&(p={...l,...JSON.parse(h)});const y=S("newFundRaiser",{state:()=>({newFundRaiser:p}),actions:{commit(t){this.newFundRaiser=t,localStorage.setItem("newFundRaiser",JSON.stringify(this.newFundRaiser))},clear(){this.newFundRaiser={category:"",subCategory:"",title:"",story:"",country:f,currency:g,titleMode:"write",goal:"",sdgs:[]},localStorage.removeItem("newFundRaiser")}}}),R={createFundRaiserCurrentStep:()=>window.localStorage.getItem("createFundRaiserCurrentStep"),draftFundRaiser:()=>JSON.parse(window.localStorage.getItem("draftFundRaiser")),newFundRaiser:()=>y().$state.newFundRaiser,newFundRaiserIsComplete:t=>JSON.parse(window.localStorage.getItem("newFundRaiserIsComplete")||"false"),userFundRaisers:async()=>{try{return await a.get("/me/fundraisers",{authorizeRequest:!0})}catch(t){throw t}},fundRaiser:async t=>{try{const{data:e,meta:r}=await a.get(`fundraisers/${t}`,{authorizeRequest:!1});return{...e,beneficiary:r}}catch(e){throw e}},donations:async({raiserId:t,search:e,sort:r,direction:o,page:i=0,size:n=50})=>{try{let s="";if(!t&&!e)throw new w("Raiser Id or Giver Email must be set to retrieve donations");t?s+="r="+t:s+="s="+e,r&&(s+="&sort="+r),o&&(s+="&direction="+o),i&&(s+="&page="+i),n&&(s+="&size="+n);const{data:u}=await a.get(`donations?${s}`,{authorizeRequest:!1});return u}catch(s){throw s}},ledger:async({raiserId:t,sort:e,direction:r,page:o=0,size:i=50})=>{try{let n="";if(!t)throw new w("Raiser Id must be set to retrieve ledger");t&&(n+="r="+t),e&&(n+="&sort="+e),r&&(n+="&direction="+r),o&&(n+="&page="+o),i&&(n+="&size="+i);const{data:s}=await a.get(`ledgers?${n}`,{authorizeRequest:!1});return s}catch(n){throw n}}},q={createFundRaiserCurrentStep:t=>{window.localStorage.setItem("createFundRaiserCurrentStep",t)},draftFundRaiser:t=>{window.localStorage.setItem("draftFundRaiser",JSON.stringify(t))},newFundRaiserIsComplete:t=>{window.localStorage.setItem("newFundRaiserIsComplete",t)},newFundRaiser:async t=>{y().commit(t)}},z={createFundRaiserCurrentStep:()=>{window.localStorage.removeItem("createFundRaiserCurrentStep")},newFundRaiserIsComplete:()=>{window.localStorage.removeItem("newFundRaiserIsComplete")},newFundRaiser:async()=>{y().clear()},draftFundRaiser:()=>{window.localStorage.removeItem("draftFundRaiser")}},b={async get(t,e){try{return await R[t](e)}catch{return}},async ledger(t){return R.ledger(t)},async set(t,e){try{await q[t](e)}catch{throw new Error(`Unable to set ${t}`)}},async clear(t){try{await z[t]()}catch{throw new Error(`Unable to clear ${t}`)}},async commitNewFundRaiser(t){try{const{data:e}=await a.post("fundraisers",{data:{...t},authorizeRequest:!0});return this.clear("newFundRaiser"),this.clear("newFundRaiserIsComplete"),this.clear("createFundRaiserCurrentStep"),e}catch(e){throw e}},async generateTitlesForStory(t){try{const{data:e}=await a.post("fundraiser-story",{data:{story:t}});return e}catch(e){throw $().toast({message:e.message,duration:5e3,type:"error"}),e}},async searchFundRaisers(t){const{size:e=27,page:r=0,offset:o=0,keyword:i="",sort:n=["updatedAt","desc"],category:s="",country:u="Nigeria"}=t||{};let F=`keyword=${i}&country=${u}&category=${s}&page=${r}&size=${e}&sort=${n[0]},${n[1]},updatedAt,desc`;try{const{data:c}=await a.get(`fundraisers?${F}`,{authorizeRequest:!1}),{content:m}=c;return this.storeFundRaisers(m),c}catch(c){throw c}},async getFundRaiserById(t){try{const{data:e}=await a.get(`/me/fundraisers/${t}`,{authorizeRequest:!1});return e}catch(e){throw e}},async updateFundRaiser(t,e){try{return await a.patch(`/me/fundraisers/${t}?`,{data:{...e},authorizeRequest:!0})}catch(r){throw r}},async updateSectionData(t,e,r){try{return await a.put(`/me/fundraisers/${t}?section=${e}`,{data:{...r},authorizeRequest:!0})}catch(o){throw o}},async createDonation(t){try{return await a.post("donations",{data:{...t},authorizeRequest:!1})}catch(e){throw e}},async subscribeForUpdates(t,e){try{return await a.put(`fundraisers/${t}/update-subscription`,{data:{...e},authorizeRequest:!1})}catch(r){throw r}},async shareSupportMessage(t,e){try{return await a.post(`donations/${t}/support-message`,{data:{...e},authorizeRequest:!1})}catch(r){throw r}},async getSupportMessages(t){try{const{data:e}=await a.get(`fundraisers/${t}/support-messages`,{});return e}catch(e){throw e}},async saveFeedback(t,e){try{const{data:r}=await a.post(`fundraisers/${t}/feedback`,{data:{...e},authorizeRequest:!0});return r}catch(r){throw r}},async updateFeedback(t,e){try{const{data:r}=await a.patch(`fundraisers/${t}/feedback/${e.id}`,{data:{...e,id:void 0},authorizeRequest:!0});return r}catch(r){throw r}},async getFeedback(t){try{const{data:e}=await a.get(`fundraisers/${t}/feedback`,{authorizeRequest:!0});return e}catch(e){throw e}},async getRaiserByReference(t){try{const{data:e}=await a.get(`fundraisers?reference=${t}`,{authorizeRequest:!1});return e}catch(e){throw e}},async getMyRaiserByReference(t){try{const{data:e}=await a.get(`/me/fundraisers/${t}`,{authorizeRequest:!0});return this.storeFundRaisers([e]),e}catch(e){throw e}},async generateSummarySuggestion(t){try{return await a.get(`/me/fundraisers/${t}/summary`,{authorizeRequest:!0})}catch(e){throw e}},async downloadFlyer(t,e){await a.open(`fundraisers/${t}/Flyer`,{variant:e})},async sendDonationRequest(t){try{const{data:e}=await a.post("donation-requests",{data:{...t},authorizeRequest:!0});return e}catch(e){throw e}},async getDonation(t){try{const{data:e}=await a.get(`donations/${t}`,{authorizeRequest:!1});return e}catch(e){throw e}},async getMyFundRaiserDonations({reference:t,search:e,sort:r,direction:o,page:i=0,size:n=50}){try{let s="";if(!t)throw new w("Raiser reference must be set to retrieve donations");e&&(s+="s="+e),r&&(s+="&sort="+r),o&&(s+="&direction="+o),i&&(s+="&page="+i),n&&(s+="&size="+n);const{data:u}=await a.get(`/me/fundraisers/${t}/donations?${s}`,{authorizeRequest:!0});return u}catch(s){throw s}},async addOfflineDonation(t,e){try{return await a.post(`/me/fundraisers/${t}/donations?offline=true`,{data:{...e},authorizeRequest:!0})}catch(r){throw r}},async addBeneficiary(t,e){try{return await a.post(`/me/fundraisers/${t}/beneficiaries`,{data:{...e},authorizeRequest:!0})}catch(r){throw r}},async getBeneficiaries(t){try{return await a.get(`/me/fundraisers/${t}/beneficiaries`,{authorizeRequest:!0})}catch(e){throw e}},async getFundRaiserFromStore({reference:t,id:e,urlPath:r}){return(await d.IndexedDB.get("DonnerDB","UserStore","raisers")).find(n=>n.reference===t||n.id===e||n.urlPath||r)||{reference:t,id:e,urlPath:r}},async storeFundRaisers(t=[]){if(t.length===0)return;let e=[];try{e=[...await d.IndexedDB.get("DonnerDB","UserStore","raisers"),...t]}catch{e=[...t]}e.length,await d.IndexedDB.set("DonnerDB","UserStore","raisers",e)},updateSharingSettings:async(t,e)=>{try{return await a.put(`/me/fundraisers/${t}/sharing-settings`,{data:{...e},authorizeRequest:!0})}catch(r){throw r}},async removeTimelineImage(t,e){return await a.delete(`/me/fundraisers/${t}/timeline-images/${e}`,{authorizeRequest:!0})}};export{b as F};
