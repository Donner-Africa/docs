import{B as D}from"./BaseButton-76ee64c4.js";import{l as _,U as h,S as u,A as m,p,r as g,a as r,f as d,b as i,q as T,s as v,F as S,g as B,n as A,v as E,C as V,d as I,w as y,e as f,t as w,c as C}from"./index-c49e93e4.js";import{N as x}from"./NavigationService-25564ad8.js";import"./NavigationStore-4749d2b5.js";const P={components:{BaseButton:D},data(){return{loading:!1,resendCount:0,resendWaitTime:0,token:[],verification:{}}},async mounted(){const e=await h.get("isLoggedIn"),t=await h.get("user");if(e&&t.name)return this.$router.push("/");if(this.$route.params.token)await this.verifyEmail(this.$route.params.token);else{const{token:o}=await u.IndexedDB.get("DonnerDB","UserStore","preAuthorization"),a=await u.IndexedDB.get("DonnerDB","UserStore","verification");this.verification=a||{},o||this.$router.push("/account/login")}},computed:{formDisabled(){return this.loading||void 0},codeLength(){var e;return((e=this.verification)==null?void 0:e.credentialType)==="PASSCODE"?4:6},inputType(){var e;return((e=this.verification)==null?void 0:e.credentialType)==="PASSCODE"?"password":"text"},instructionText(){var e;return((e=this.verification)==null?void 0:e.credentialType)==="PASSCODE"?"Enter your account passcode to continue":"A verification code has been sent to your email. If you do not receive the code in 15 minutes, you can"}},methods:{paste(e,t){const o=(e.clipboardData||window.clipboardData).getData("text").trim();this.token=["",...o.split("")],o.length===this.codeLength&&this.completeVerification()},focusNext(e,t){const o=`${e.target.value}`.trim();if(t==this.codeLength&&o)return this.completeVerification();if(o.length===1&&t<this.codeLength){const a="otpInput"+(t+1);this.$refs[a][0].focus()}o.length===0&&t>1&&this.$refs["otpInput"+(t-1)][0].focus()},countDown(){this.resendWaitTime=60+this.resendCount;const e=setInterval(()=>--this.resendWaitTime,999);setTimeout(()=>{clearInterval(e),this.resendWaitTime=0},this.resendWaitTime*1e3)},async completeVerification(){this.loading=!0;try{const e=this.token.reduce((o,a)=>`${o}${a}`),{data:t}=await m.completeAccountVerification({code:e});if(t){const o=await x.get("postAuthenticationPath");await u.IndexedDB.delete("DonnerDB","UserStore","verification"),o?(this.$router.push(o),x.clear("postAuthenticationPath")):window.location="/"}}catch(e){e.getToast?p().toast({message:"A verification error occured. Please, check your code and try again. ",duration:5e3,type:"error"}):console.log(e)}this.loading=!1},async verifyEmail(e){const t=p();try{const{data:o,message:a}=await m.initiateAccountVerification(e);this.countDown(),this.resendWaitTime+=90,t.toast({message:a||"A verification code has been delivered to your email address",type:"success",duration:5e3})}catch{t.toast({message:"There was an error with your verification. Try again.",type:"error",duration:5e3})}},async switchToEmail(){this.loading=!0;const e=p();try{const{data:t}=await m.downgradeToEmail();this.verification=t.verification,await u.IndexedDB.set("DonnerDB","UserStore","verification",t.verification),this.token=[],this.countDown(),e.toast({message:"Switched to Email Verification. Please check your inbox.",type:"success"})}catch(t){e.toast({message:t.message||"Failed to switch to email verification.",type:"error"})}this.loading=!1}}},L={class:"page-header min-vh-100 align-items-start",style:{background:"#EDF9E8"}},U={class:"container px-sm-auto px-0"},N={class:"row"},W={class:"col-lg-6 col-md-7 mx-sm-auto mx-0 my-0 my-sm-5 px-0 px-sm-auto py-sm-7"},F={class:"card rounded-3 min-vh-100 min-vh-sm-80 bg-white",style:{}},z={class:"card-body px-lg-5 py-lg-5 text-start"},O={class:"px-md-4 ps-2 pe-4 row"},q={class:"form-group mt-3"},M={class:"row"},R={class:"form-group"},K=["type","onUpdate:modelValue","disabled","onInput"],Y={class:"form-group mt-3 pt-4"},j={key:0,class:"w-[100%] mb-4 text-bold text-dark"},G={key:1,class:"w-[100%] mb-4 text-gradient text-dark"};function H(e,t,o,a,c,s){const b=g("BaseButton"),k=g("RouterLink");return r(),d("div",null,[i("section",null,[i("div",L,[t[7]||(t[7]=i("div",{class:"mask bg-success-light opacity-10 d-none d-md-block"},null,-1)),t[8]||(t[8]=i("div",{class:"mask opacity-1",style:{"background-image":"url('/img/shapes/waves-green.png')",filter:"blur(5px)"}},null,-1)),i("div",U,[i("div",N,[i("div",W,[i("div",F,[i("div",z,[t[5]||(t[5]=i("div",{class:"success mb-6 mb-md-4"},[i("a",{href:"/",class:"d-none d-md-inline-block icon icon-shape icon-xl rounded-circle bg-white shadow text-center p-3 mx-auto"},[i("img",{src:T,class:"w-[90%] h-[90%] mt-1"})])],-1)),t[6]||(t[6]=i("h2",null,"Verify your account",-1)),i("form",{class:"form-section active",onSubmit:t[2]||(t[2]=v((...n)=>s.completeVerification&&s.completeVerification(...n),["prevent"]))},[i("div",O,[i("div",q,[i("div",M,[(r(!0),d(S,null,B(s.codeLength,n=>(r(),d("div",{class:A(s.codeLength===4?"col-3":"col-2"),key:n},[i("div",R,[E(i("input",{type:s.inputType,class:"form-control form-control-lg text-center px-0 border",maxlength:"1","onUpdate:modelValue":l=>c.token[n]=l,autocomplete:"off",disabled:s.formDisabled,autocapitalize:"none",ref_for:!0,ref:"otpInput"+n,onPaste:t[0]||(t[0]=v((...l)=>s.paste&&s.paste(...l),["prevent"])),onInput:l=>s.focusNext(l,n)},null,40,K),[[V,c.token[n]]])])],2))),128))])]),i("div",Y,[I(b,{class:"btn btn-success float-end",loading:c.loading,nativeType:"submit"},{default:y(()=>[...t[3]||(t[3]=[f(" Continue ",-1)])]),_:1},8,["loading"])]),c.resendWaitTime==0?(r(),d("span",j,[f(w(s.instructionText)+" ",1),c.verification.credentialType!=="PASSCODE"?(r(),C(k,{key:0,to:"/account/login",style:{cursor:"pointer"},class:"text-success"},{default:y(()=>[...t[4]||(t[4]=[f(" request another code ",-1)])]),_:1})):(r(),d("span",{key:1,onClick:t[1]||(t[1]=(...n)=>s.switchToEmail&&s.switchToEmail(...n)),style:{cursor:"pointer"},class:"text-success font-weight-bold"}," Forgot Passcode? Use Email "))])):(r(),d("span",G," You can request another verification code in "+w(c.resendWaitTime)+"s ",1))])],32)])])])])])])])])}const $=_(P,[["render",H]]);export{$ as default};
