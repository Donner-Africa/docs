import{M as E}from"./Modal-a35ebe6e.js";import{P as N}from"./PermissionGate-ee40ae78.js";import{A as T}from"./AuditTimeline-1e17f027.js";import{C as D}from"./ConfirmationModal-9223192d.js";import{l as O,r as y,a as o,f as r,b as s,e as h,w as c,d as a,t as d,h as m,s as M,v as A,F as f,g,m as P,n as w,c as R,q as L,x as S}from"./index-5f7a37b4.js";const F={name:"TeamManagement",components:{Modal:E,PermissionGate:N,AuditTimeline:T,ConfirmationModal:D},data(){return{loading:!0,loadingActivity:!1,inviting:!1,changingRole:!1,removing:!1,currentUserId:1,userRole:"ORG_OWNER",userPermissions:["team:view","team:invite","team:edit","team:remove"],memberLimit:10,memberCount:8,members:[],activityLog:[],searchQuery:"",showInviteModal:!1,showEditRoleModal:!1,showRemoveModal:!1,inviteForm:{email:"",role:""},editingMember:null,newRole:"",memberToRemove:null,availableRoles:[{value:"ADMIN",label:"Admin",description:"Full operational access except billing",permissions:["All operations","Team management","Settings"]},{value:"FINANCE",label:"Finance",description:"Payout management and financial reports",permissions:["Payouts","Vendors","Financial reports"]},{value:"OPERATIONS",label:"Operations",description:"Beneficiary & program management",permissions:["Beneficiaries","Fundraisers","Updates"]},{value:"COMPLIANCE",label:"Compliance",description:"KYC review and audit access",permissions:["KYC review","Audit logs","Approvals"]},{value:"ANALYST",label:"Analyst",description:"Read-only access with export capabilities",permissions:["View all data","Export reports"]}]}},computed:{isNearMemberLimit(){return this.memberCount>=this.memberLimit-2},isAtMemberLimit(){return this.memberCount>=this.memberLimit},filteredMembers(){if(!this.searchQuery)return this.members;const n=this.searchQuery.toLowerCase();return this.members.filter(e=>{var u,v;return((u=e.name)==null?void 0:u.toLowerCase().includes(n))||((v=e.email)==null?void 0:v.toLowerCase().includes(n))})},roleImpact(){if(!this.editingMember||!this.newRole)return{gained:[],lost:[]};const n=this.getRolePermissions(this.editingMember.role),e=this.getRolePermissions(this.newRole);return{gained:e.filter(u=>!n.includes(u)),lost:n.filter(u=>!e.includes(u))}}},methods:{getInitials(n){return n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?"},formatRole(n){return{ORG_OWNER:"Owner",ADMIN:"Admin",FINANCE:"Finance",OPERATIONS:"Operations",COMPLIANCE:"Compliance",ANALYST:"Analyst",AUDITOR:"Auditor"}[n]||n},getRoleBadgeClass(n){return{ORG_OWNER:"bg-dark",ADMIN:"bg-primary",FINANCE:"bg-success",OPERATIONS:"bg-info",COMPLIANCE:"bg-warning text-dark",ANALYST:"bg-secondary",AUDITOR:"bg-light text-dark"}[n]||"bg-secondary"},formatStatus(n){return{active:"Active",suspended:"Suspended",invited:"Invited"}[n]||n},formatRelativeTime(n){if(!n)return"";const e=new Date(n),v=new Date-e,i=Math.floor(v/6e4);if(i<1)return"Just now";if(i<60)return`${i}m ago`;const l=Math.floor(v/36e5);return l<24?`${l}h ago`:`${Math.floor(v/864e5)}d ago`},formatFullDate(n){return new Date(n).toLocaleString()},getRolePermissions(n){const e=this.availableRoles.find(u=>u.value===n);return(e==null?void 0:e.permissions)||[]},canEditMember(n){const e=["AUDITOR","ANALYST","COMPLIANCE","OPERATIONS","FINANCE","ADMIN","ORG_OWNER"],u=e.indexOf(this.userRole),v=e.indexOf(n.role);return u>v},openEditRoleModal(n){this.editingMember=n,this.newRole=n.role,this.showEditRoleModal=!0},openRemoveModal(n){this.memberToRemove=n,this.showRemoveModal=!0},async fetchMembers(){this.loading=!0;try{await new Promise(n=>setTimeout(n,500)),this.members=[{id:1,name:"Jane Doe",email:"jane@org.com",role:"ORG_OWNER",status:"active",lastActive:new Date(Date.now()-12e4),isCurrentUser:!0},{id:2,name:"John Kamara",email:"john@org.com",role:"ADMIN",status:"active",lastActive:new Date(Date.now()-864e5),isCurrentUser:!1},{id:3,name:"Mary Smith",email:"mary@org.com",role:"FINANCE",status:"suspended",lastActive:null,isCurrentUser:!1},{id:4,name:null,email:"new@org.com",role:"OPERATIONS",status:"invited",lastActive:null,isCurrentUser:!1}],this.activityLog=[{id:1,action:"MEMBER_INVITED",entity:"new@org.com",actor:"Jane Doe",timestamp:new Date(Date.now()-36e5)},{id:2,action:"ROLE_CHANGED",entity:"Mary Smith: Operations → Finance",actor:"Jane Doe",timestamp:new Date(Date.now()-864e5)},{id:3,action:"MEMBER_SUSPENDED",entity:"Mary Smith",actor:"Jane Doe",timestamp:new Date(Date.now()-864e5*2),details:{reason:"Security review"}},{id:4,action:"LOGIN_BLOCKED",entity:"Mary Smith",actor:"System",timestamp:new Date(Date.now()-864e5*2)}]}finally{this.loading=!1}},async inviteMember(){this.inviting=!0;try{await new Promise(n=>setTimeout(n,1e3)),this.showInviteModal=!1,this.inviteForm={email:"",role:""},this.memberCount++,this.fetchMembers(),alert("Invitation sent successfully")}finally{this.inviting=!1}},async changeRole(){this.changingRole=!0;try{await new Promise(n=>setTimeout(n,1e3)),this.showEditRoleModal=!1,this.editingMember=null,this.newRole="",this.fetchMembers(),alert("Role changed successfully")}finally{this.changingRole=!1}},async suspendMember(n){confirm(`Suspend ${n.name}?`)&&(await new Promise(e=>setTimeout(e,500)),this.fetchMembers(),alert("Member suspended"))},async reactivateMember(n){await new Promise(e=>setTimeout(e,500)),this.fetchMembers(),alert("Member reactivated")},async resendInvite(n){await new Promise(e=>setTimeout(e,500)),alert("Invitation resent")},async removeMember(){this.removing=!0;try{await new Promise(n=>setTimeout(n,1e3)),this.showRemoveModal=!1,this.memberToRemove=null,this.memberCount--,this.fetchMembers(),alert("Member removed")}finally{this.removing=!1}}},async mounted(){await this.fetchMembers()}},U={class:"team-management"},B={class:"page-header mb-4"},V={class:"row align-items-center"},G={class:"col-md-6 text-md-end mt-3 mt-md-0"},q=["disabled"],W={key:0,class:"alert alert-warning d-flex justify-content-between align-items-center mb-4"},Y={key:0},j={class:"card shadow-none border mb-4"},J={class:"card-header bg-white d-flex justify-content-between align-items-center"},Q={class:"input-group",style:{width:"250px"}},K={class:"card-body p-0"},z={key:0,class:"p-4"},H={key:1,class:"table-responsive"},X={class:"table table-hover mb-0"},Z={class:"d-flex align-items-center"},$={key:0,class:"fa fa-envelope"},ee={class:"fw-semibold text-foreground"},se={key:0,class:"badge bg-light text-dark ms-1"},te={class:"text-muted"},ie=["title"],ne={key:1,class:"text-muted"},oe={class:"text-end"},le={class:"btn-group btn-group-sm"},re=["onClick"],ae=["onClick"],de=["onClick"],me=["onClick"],ue=["onClick"],ce={class:"card shadow-none border"},ve={class:"card-body"},be={class:"mb-4"},fe={class:"mb-4"},ge={class:"role-options"},pe=["onClick"],he={class:"d-flex justify-content-between align-items-start"},we={class:"fw-bold text-foreground"},ye={class:"text-muted"},Me={class:"form-check"},Re=["checked","onChange"],Ce={key:0,class:"permission-preview p-3 bg-light rounded"},_e={class:"permissions-list"},ke=["disabled"],Ae={key:0,class:"fa fa-spinner fa-spin me-1"},xe={key:0},Ie={class:"mb-4 text-foreground opacity-8"},Ee={class:"mb-4"},Ne={class:"mb-4"},Te=["value","disabled"],De={key:0,class:"impact-analysis p-3 rounded mb-3"},Oe={key:0,class:"mb-2"},Pe={class:"mb-0 ps-3"},Le={key:1},Se={class:"mb-0 ps-3"},Fe=["disabled"],Ue={key:0,class:"fa fa-spinner fa-spin me-1"};function Be(n,e,u,v,i,l){var _,k;const p=y("permission-gate"),x=y("audit-timeline"),C=y("modal"),I=y("confirmation-modal");return o(),r("div",U,[s("div",B,[s("div",V,[e[13]||(e[13]=s("div",{class:"col-md-6"},[s("h4",{class:"mb-1 text-foreground"},"Team Management"),s("p",{class:"text-muted mb-0"},"Manage team members, roles, and permissions")],-1)),s("div",G,[h(p,{requires:"team:invite","user-permissions":i.userPermissions,"user-role":i.userRole},{default:c(()=>[s("button",{class:"btn btn-success",onClick:e[0]||(e[0]=t=>i.showInviteModal=!0),disabled:l.isAtMemberLimit},[...e[12]||(e[12]=[s("i",{class:"fa fa-user-plus me-1"},null,-1),a(" Invite Member ",-1)])],8,q)]),_:1},8,["user-permissions","user-role"])])])]),l.isNearMemberLimit?(o(),r("div",W,[s("div",null,[e[14]||(e[14]=s("i",{class:"fa fa-exclamation-triangle me-2"},null,-1)),s("strong",null,d(i.memberCount)+" / "+d(i.memberLimit),1),e[15]||(e[15]=a(" team members used. ",-1)),l.isAtMemberLimit?(o(),r("span",Y,"Upgrade your plan to add more members.")):m("",!0)]),e[16]||(e[16]=s("button",{class:"btn btn-sm btn-warning"},"Upgrade Plan",-1))])):m("",!0),s("div",j,[s("div",J,[e[18]||(e[18]=s("h6",{class:"mb-0 text-foreground"},[s("i",{class:"fa fa-users me-2"}),a(" Team Members ")],-1)),s("div",Q,[e[17]||(e[17]=s("span",{class:"input-group-text bg-white border-end-0"},[s("i",{class:"fa fa-search text-muted"})],-1)),M(s("input",{type:"text",class:"form-control border-start-0",placeholder:"Search members...","onUpdate:modelValue":e[1]||(e[1]=t=>i.searchQuery=t)},null,512),[[A,i.searchQuery]])])]),s("div",K,[i.loading?(o(),r("div",z,[(o(),r(f,null,g(4,t=>s("div",{key:t,class:"skeleton-row mb-3"},[...e[19]||(e[19]=[P('<div class="d-flex gap-3 align-items-center" data-v-e7a7af74><div class="skeleton skeleton-avatar" data-v-e7a7af74></div><div class="flex-grow-1" data-v-e7a7af74><div class="skeleton skeleton-text mb-2" style="width:40%;" data-v-e7a7af74></div><div class="skeleton skeleton-text" style="width:60%;" data-v-e7a7af74></div></div><div class="skeleton skeleton-badge" data-v-e7a7af74></div></div>',1)])])),64))])):(o(),r("div",H,[s("table",X,[e[26]||(e[26]=s("thead",{class:"table-light"},[s("tr",null,[s("th",{class:"border-0"},"Member"),s("th",{class:"border-0"},"Role"),s("th",{class:"border-0"},"Status"),s("th",{class:"border-0"},"Last Active"),s("th",{class:"border-0 text-end"},"Actions")])],-1)),s("tbody",null,[(o(!0),r(f,null,g(l.filteredMembers,t=>(o(),r("tr",{key:t.id},[s("td",null,[s("div",Z,[s("div",{class:w(["avatar-circle me-3",{"bg-muted":t.status==="invited"}])},[t.status==="invited"?(o(),r("i",$)):(o(),r(f,{key:1},[a(d(l.getInitials(t.name)),1)],64))],2),s("div",null,[s("div",ee,[a(d(t.name||"Pending Invitation")+" ",1),t.isCurrentUser?(o(),r("span",se,"You")):m("",!0)]),s("small",te,d(t.email),1)])])]),s("td",null,[s("span",{class:w(["badge",l.getRoleBadgeClass(t.role)])},d(l.formatRole(t.role)),3)]),s("td",null,[s("span",{class:w(["status-indicator",`status-${t.status}`])},[e[20]||(e[20]=s("i",{class:"fa fa-circle me-1"},null,-1)),a(" "+d(l.formatStatus(t.status)),1)],2)]),s("td",null,[t.lastActive?(o(),r("span",{key:0,title:l.formatFullDate(t.lastActive)},d(l.formatRelativeTime(t.lastActive)),9,ie)):(o(),r("span",ne,"—"))]),s("td",oe,[s("div",le,[!t.isCurrentUser&&l.canEditMember(t)?(o(),R(p,{key:0,requires:"team:edit","user-permissions":i.userPermissions,"user-role":i.userRole},{default:c(()=>[s("button",{class:"btn btn-outline-secondary btn-sm",onClick:b=>l.openEditRoleModal(t),title:"Edit Role"},[...e[21]||(e[21]=[s("i",{class:"fa fa-edit"},null,-1)])],8,re)]),_:2},1032,["user-permissions","user-role"])):m("",!0),!t.isCurrentUser&&l.canEditMember(t)&&t.status!=="invited"?(o(),R(p,{key:1,requires:"team:edit","user-permissions":i.userPermissions,"user-role":i.userRole},{default:c(()=>[t.status==="active"?(o(),r("button",{key:0,class:"btn btn-outline-warning btn-sm",onClick:b=>l.suspendMember(t),title:"Suspend"},[...e[22]||(e[22]=[s("i",{class:"fa fa-pause"},null,-1)])],8,ae)):t.status==="suspended"?(o(),r("button",{key:1,class:"btn btn-outline-success btn-sm",onClick:b=>l.reactivateMember(t),title:"Reactivate"},[...e[23]||(e[23]=[s("i",{class:"fa fa-play"},null,-1)])],8,de)):m("",!0)]),_:2},1032,["user-permissions","user-role"])):m("",!0),t.status==="invited"?(o(),r("button",{key:2,class:"btn btn-outline-info btn-sm",onClick:b=>l.resendInvite(t),title:"Resend Invitation"},[...e[24]||(e[24]=[s("i",{class:"fa fa-redo"},null,-1)])],8,me)):m("",!0),!t.isCurrentUser&&l.canEditMember(t)?(o(),R(p,{key:3,requires:"team:remove","user-permissions":i.userPermissions,"user-role":i.userRole},{default:c(()=>[s("button",{class:"btn btn-outline-danger btn-sm",onClick:b=>l.openRemoveModal(t),title:"Remove"},[...e[25]||(e[25]=[s("i",{class:"fa fa-times"},null,-1)])],8,ue)]),_:2},1032,["user-permissions","user-role"])):m("",!0)])])]))),128))])])]))])]),s("div",ce,[e[27]||(e[27]=s("div",{class:"card-header bg-white"},[s("h6",{class:"mb-0 text-foreground"},[s("i",{class:"fa fa-history me-2"}),a(" Team Activity Log ")])],-1)),s("div",ve,[h(x,{entries:i.activityLog,loading:i.loadingActivity,title:"","initial-limit":10,"max-height":"400px"},null,8,["entries","loading"])])]),h(C,{show:i.showInviteModal,"onUpdate:show":e[6]||(e[6]=t=>i.showInviteModal=t)},{header:c(()=>[...e[28]||(e[28]=[s("h5",{class:"modal-title"},[s("i",{class:"fa fa-user-plus me-2 text-success"}),a(" Invite Team Member ")],-1)])]),footer:c(()=>[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[4]||(e[4]=t=>i.showInviteModal=!1)}," Cancel "),s("button",{type:"button",class:"btn btn-success",onClick:e[5]||(e[5]=(...t)=>l.inviteMember&&l.inviteMember(...t)),disabled:i.inviting||!i.inviteForm.email||!i.inviteForm.role},[i.inviting?(o(),r("i",Ae)):m("",!0),e[32]||(e[32]=a(" Send Invitation ",-1))],8,ke)]),default:c(()=>[s("form",{onSubmit:e[3]||(e[3]=L((...t)=>l.inviteMember&&l.inviteMember(...t),["prevent"]))},[s("div",be,[e[29]||(e[29]=s("label",{class:"form-label"},[a("Email Address "),s("span",{class:"text-danger"},"*")],-1)),M(s("input",{type:"email",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=t=>i.inviteForm.email=t),placeholder:"newmember@organization.org",required:""},null,512),[[A,i.inviteForm.email]])]),s("div",fe,[e[30]||(e[30]=s("label",{class:"form-label"},[a("Assign Role "),s("span",{class:"text-danger"},"*")],-1)),s("div",ge,[(o(!0),r(f,null,g(i.availableRoles,t=>(o(),r("div",{key:t.value,class:w(["role-option p-3 rounded mb-2",{selected:i.inviteForm.role===t.value}]),onClick:b=>i.inviteForm.role=t.value},[s("div",he,[s("div",null,[s("div",we,d(t.label),1),s("small",ye,d(t.description),1)]),s("div",Me,[s("input",{type:"radio",class:"form-check-input",checked:i.inviteForm.role===t.value,onChange:b=>i.inviteForm.role=t.value},null,40,Re)])])],10,pe))),128))])]),i.inviteForm.role?(o(),r("div",Ce,[e[31]||(e[31]=s("h6",{class:"text-foreground mb-2"},[s("i",{class:"fa fa-shield-alt me-1"}),a(" Role Permissions ")],-1)),s("div",_e,[(o(!0),r(f,null,g(l.getRolePermissions(i.inviteForm.role),t=>(o(),r("span",{key:t,class:"badge bg-success me-1 mb-1"},d(t),1))),128))])])):m("",!0)],32)]),_:1},8,["show"]),h(C,{show:i.showEditRoleModal,"onUpdate:show":e[10]||(e[10]=t=>i.showEditRoleModal=t)},{header:c(()=>[...e[33]||(e[33]=[s("h5",{class:"modal-title"},[s("i",{class:"fa fa-user-edit me-2 text-success"}),a(" Change Role ")],-1)])]),footer:c(()=>{var t;return[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[8]||(e[8]=b=>i.showEditRoleModal=!1)}," Cancel "),s("button",{type:"button",class:"btn btn-primary",onClick:e[9]||(e[9]=(...b)=>l.changeRole&&l.changeRole(...b)),disabled:i.changingRole||!i.newRole||i.newRole===((t=i.editingMember)==null?void 0:t.role)},[i.changingRole?(o(),r("i",Ue)):m("",!0),e[41]||(e[41]=a(" Confirm Change ",-1))],8,Fe)]}),default:c(()=>[i.editingMember?(o(),r("div",xe,[s("p",Ie,[e[34]||(e[34]=a(" Changing role for ",-1)),s("strong",null,d(i.editingMember.name),1)]),s("div",Ee,[e[35]||(e[35]=s("label",{class:"form-label"},"Current Role",-1)),s("div",null,[s("span",{class:w(["badge",l.getRoleBadgeClass(i.editingMember.role)])},d(l.formatRole(i.editingMember.role)),3)])]),s("div",Ne,[e[36]||(e[36]=s("label",{class:"form-label"},"New Role",-1)),M(s("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=t=>i.newRole=t)},[(o(!0),r(f,null,g(i.availableRoles,t=>(o(),r("option",{key:t.value,value:t.value,disabled:t.value===i.editingMember.role},d(t.label),9,Te))),128))],512),[[S,i.newRole]])]),i.newRole&&i.newRole!==i.editingMember.role?(o(),r("div",De,[e[39]||(e[39]=s("h6",{class:"text-foreground mb-3"},"Impact Analysis",-1)),l.roleImpact.gained.length?(o(),r("div",Oe,[e[37]||(e[37]=s("span",{class:"text-success fw-bold"},"Will GAIN:",-1)),s("ul",Pe,[(o(!0),r(f,null,g(l.roleImpact.gained,t=>(o(),r("li",{key:t,class:"text-success"},d(t),1))),128))])])):m("",!0),l.roleImpact.lost.length?(o(),r("div",Le,[e[38]||(e[38]=s("span",{class:"text-danger fw-bold"},"Will LOSE:",-1)),s("ul",Se,[(o(!0),r(f,null,g(l.roleImpact.lost,t=>(o(),r("li",{key:t,class:"text-danger"},d(t),1))),128))])])):m("",!0)])):m("",!0),e[40]||(e[40]=s("div",{class:"alert alert-info"},[s("i",{class:"fa fa-info-circle me-1"}),a(" This change will be logged and is reversible. ")],-1))])):m("",!0)]),_:1},8,["show"]),h(I,{show:i.showRemoveModal,"onUpdate:show":e[11]||(e[11]=t=>i.showRemoveModal=t),title:"Remove Team Member",message:`Are you sure you want to remove ${((_=i.memberToRemove)==null?void 0:_.name)||((k=i.memberToRemove)==null?void 0:k.email)} from the team?`,destructive:!0,"destructive-message":"They will immediately lose access to all organization resources.","confirm-text":"Remove Member",processing:i.removing,onConfirm:l.removeMember},null,8,["show","message","processing","onConfirm"])])}const je=O(F,[["render",Be],["__scopeId","data-v-e7a7af74"]]);export{je as default};
