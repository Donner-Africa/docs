import{B as y}from"./BaseButton-7f466b62.js";import{l as v,p as m,A as p,r as k,a as c,f as d,b as t,q as x,s as h,F as b,g as w,v as _,x as P,d as V,w as S,e as f,t as T,h as C}from"./index-224ff9c4.js";import{N as g}from"./NavigationService-72df6fd0.js";import"./NavigationStore-53124adf.js";const L={components:{BaseButton:y},data(){return{loading:!1,resendCount:0,resendWaitTime:0,token:[],codeLength:6,verifyingLink:!1}},created(){this.$route.params.token&&(this.verifyingLink=!0)},async mounted(){this.$route.params.token&&(await this.verifyEmailToken(this.$route.params.token),this.verifyingLink=!1)},computed:{formDisabled(){return this.loading||void 0},isSkippable(){var s;return((s=this.$route.meta)==null?void 0:s.skippable)===!0}},methods:{async verifyEmailToken(s){const e=m();this.loading=!0;try{const{data:o,message:r}=await p.initiateAccountVerification(s);e.toast({message:r||"Email verified. Please verify your phone number.",type:"success",duration:5e3})}catch(o){e.toast({message:o.message||"There was an error with your verification link.",type:"error",duration:5e3})}this.loading=!1},paste(s,e){const o=(s.clipboardData||window.clipboardData).getData("text").trim();this.token=["",...o.split("")],o.length===this.codeLength&&this.completeVerification()},focusNext(s,e){const o=`${s.target.value}`.trim();if(e==this.codeLength&&o)return this.completeVerification();if(o.length===1&&e<this.codeLength){const r="otpInput"+(e+1);this.$refs[r][0].focus()}o.length===0&&e>1&&this.$refs["otpInput"+(e-1)][0].focus()},countDown(){this.resendWaitTime=60+this.resendCount;const s=setInterval(()=>--this.resendWaitTime,999);setTimeout(()=>{clearInterval(s),this.resendWaitTime=0},this.resendWaitTime*1e3)},async completeVerification(){var s,e;this.loading=!0;try{const o=this.token.slice(1).join("");if(o.length!==this.codeLength){this.loading=!1;return}const{data:r,message:a}=await p.verifyPhone(o);m().toast({message:a||"Phone number verified successfully.",type:"success",duration:5e3});const u=await g.get("postAuthenticationPath");u?(this.$router.push(u),g.clear("postAuthenticationPath")):this.$router.push("/")}catch(o){m().toast({message:((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||"A verification error occured. Please, check your code and try again.",duration:5e3,type:"error"}),console.error(o)}this.loading=!1},async resendCode(){var e,o;this.loading=!0;const s=m();try{const{message:r}=await p.resendPhoneCode();this.countDown(),this.resendCount+=30,s.toast({message:r||"A new verification code has been sent to your phone.",type:"success",duration:5e3})}catch(r){s.toast({message:((o=(e=r.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to resend code. Please try again later.",type:"error",duration:5e3})}this.loading=!1},async skipPrompt(){this.loading=!0;try{await p.skipPrompt("phone"),this.$router.push("/me/dashboard")}catch(s){console.error("Failed to skip phone prompt",s),this.$router.push("/me/dashboard")}this.loading=!1}}},D={class:"page-header min-vh-100 align-items-start",style:{background:"#EDF9E8"}},B={class:"container px-sm-auto px-0"},N={class:"row"},A={class:"col-lg-6 col-md-7 mx-sm-auto mx-0 my-0 my-sm-5 px-0 px-sm-auto py-sm-7"},I={class:"card rounded-3 min-vh-100 min-vh-sm-80 bg-white",style:{}},W={class:"card-body px-lg-5 py-lg-5 text-start"},E={key:0,class:"text-center py-5"},F={key:1},q={class:"px-md-4 ps-2 pe-4 row"},M={class:"form-group mt-3"},U={class:"row"},j={class:"form-group"},z=["onUpdate:modelValue","disabled","onInput"],K={class:"form-group mt-3 pt-4"},R={key:0,class:"w-[100%] mb-4 text-bold text-dark"},Y={key:1,class:"w-[100%] mb-4 text-dark"},G={key:2,class:"mt-4 text-center w-[100%]"};function H(s,e,o,r,a,i){const u=k("BaseButton");return c(),d("div",null,[t("section",null,[t("div",D,[e[9]||(e[9]=t("div",{class:"mask bg-success-light opacity-10 d-none d-md-block"},null,-1)),e[10]||(e[10]=t("div",{class:"mask opacity-1",style:{"background-image":"url('/img/shapes/waves-green.png')",filter:"blur(5px)"}},null,-1)),t("div",B,[t("div",N,[t("div",A,[t("div",I,[t("div",W,[e[8]||(e[8]=t("div",{class:"success mb-6 mb-md-4"},[t("a",{href:"/",class:"d-none d-md-inline-block icon icon-shape icon-xl rounded-circle bg-white shadow text-center p-3 mx-auto"},[t("img",{src:x,class:"w-[90%] h-[90%] mt-1"})])],-1)),a.verifyingLink?(c(),d("div",E,[...e[4]||(e[4]=[t("div",{class:"spinner-border text-success",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("h4",{class:"mt-4 h5"},"Verifying Account...",-1),t("p",{class:"text-muted text-sm"},"Please wait while we verify your link",-1)])])):(c(),d("div",F,[e[7]||(e[7]=t("h2",null,"Verify your phone",-1)),t("form",{class:"form-section active",onSubmit:e[3]||(e[3]=h((...n)=>i.completeVerification&&i.completeVerification(...n),["prevent"]))},[t("div",q,[t("div",M,[t("div",U,[(c(!0),d(b,null,w(a.codeLength,n=>(c(),d("div",{class:"col-2",key:n},[t("div",j,[_(t("input",{type:"text",class:"form-control form-control-lg text-center px-0 border",maxlength:"1","onUpdate:modelValue":l=>a.token[n]=l,autocomplete:"off",disabled:i.formDisabled,autocapitalize:"none",ref_for:!0,ref:"otpInput"+n,onPaste:e[0]||(e[0]=h((...l)=>i.paste&&i.paste(...l),["prevent"])),onInput:l=>i.focusNext(l,n)},null,40,z),[[P,a.token[n]]])])]))),128))])]),t("div",K,[V(u,{class:"btn btn-success float-end",loading:a.loading,nativeType:"submit"},{default:S(()=>[...e[5]||(e[5]=[f(" Verify Phone ",-1)])]),_:1},8,["loading"])]),a.resendWaitTime==0?(c(),d("span",R,[e[6]||(e[6]=f(" Didn't receive a code? ",-1)),t("span",{onClick:e[1]||(e[1]=(...n)=>i.resendCode&&i.resendCode(...n)),style:{cursor:"pointer"},class:"text-success"}," Resend Code ")])):(c(),d("span",Y," You can request another code in "+T(a.resendWaitTime)+"s ",1)),i.isSkippable?(c(),d("div",G,[t("span",{onClick:e[2]||(e[2]=(...n)=>i.skipPrompt&&i.skipPrompt(...n)),style:{cursor:"pointer"},class:"text-muted text-decoration-underline"}," Skip for now ")])):C("",!0)])],32)]))])])])])])])])])}const Z=v(L,[["render",H]]);export{Z as default};
